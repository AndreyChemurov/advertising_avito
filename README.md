# Сервис для хранения и подачи объявлений: Авито Advertising

## Информация
- Приложение работает на порту ```8000```
- Все запросы выполняются через POST методы с JSON телом.
- Использовалось при создании: golang 1.16.5, postgres 13.2, linux debian 10.</br></br>

## Вопросы по реализации
- Может ли быть цена 0 (бесплатно) при создании объявления? - Нет.

## Запуск приложения
```bash
git clone https://github.com/AndreyChemurov/advertising_avito.git
cd advertising_avito/
[sudo] docker-compose up
```

## Запуск тестов
```bash
apt-get update && apt-get install make
make test
```

## Запуск линтеров (требует >= Go 1.15)
```bash
apt-get update && apt-get install make
go get github.com/golangci/golangci-lint/cmd/golangci-lint@v1.40.1
make lint
```

## Архитектура
1. REST запрос попадает на транспортный уровень, где происходит валидация переданных аргументов.
2. Взаимодействие с уровнем бизнес-логики происходит через структуру Service, которая реализует 3 метода: Create (создание объявление), GetAll (получение информации о всех созданных объявлениях), GetOne (получение информации об отдельном объявлении). 
4. Взаимодействие с базой данных происходит через интерфейс Database, который описывает те же методы: Create (создание объявление), GetAll (получение информации о всех созданных объявлениях), GetOne (получение информации об отдельном объявлении).
5. Структура Postgres реализует интерфейс Database, создает коннекшены и выполняет запросы.

![advertising_avito](https://user-images.githubusercontent.com/58785926/122653483-71640780-d14d-11eb-9186-14b88161f8d6.png)

## Описание пакетов
### restapi
Файлы:
- restapi.go
- error_converter.go
</br>
Пакет содежит ручки всех 3 запросов. На транспортном уровени происходит валидация переданных в теле запроса полей, вызов метода бизнес-логики и возвращение HTTP-ответа. Функция errorType оборачивает информацию об ошибке в массив байт.

### service
Файлы:
- service.go
</br>
Пакет содежит 3 соответствующие функции бизнес-логики, которые вызывают методы структуры базы (здесь postgres) через интерфейс Database и возвращают на транспортный уровень ответ от базы.

### database
Файлы:
- creation.go
- database.go
- postgres.go
</br>
Пакет содержит интерфейс Database, который описывает методы работы с базой, а так же фабричный метод формирования объекта базы. Также пакет содержит функцию создания таблиц и индексов. Структура Postgres реализует методы и делает запросы к базе, получает ответ и возвращает его на бизнес-уровнь.

### types
Файлы:
- types.go
</br>
Пакет содержит определения типов для всех запросов и ответов.

## Результаты выполнения 
**Выгрузка коллекции запросов:**</br>
[Папка с файлом json для импорта](https://github.com/AndreyChemurov/advertising_avito/tree/master/postman)
